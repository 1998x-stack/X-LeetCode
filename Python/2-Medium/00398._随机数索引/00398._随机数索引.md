[398. 随机数索引](https://leetcode.cn/problems/random-pick-index)

[ChatGPT](https://chat.openai.com/share/41b915da-7689-4495-8bc7-f945f9abe9bb)

---

## 1. 问题的内容
**1.1 题目描述**：
LeetCode题目[398. 随机数索引](https://leetcode.cn/problems/random-pick-index)的主要目标是实现一个类，该类能够根据给定的数字数组和目标值，随机返回目标值在数组中的索引。如果目标值在数组中存在多次，索引的返回应该等概率地随机。

**1.2 示例**：
假设有一个数组`nums = [1, 2, 3, 3, 3]`，并且我们想要随机地获取数字`3`在这个数组中的索引。

- 如果我们调用一次随机获取`3`的索引方法，可能返回`2`。
- 如果我们再次调用，可能返回`4`。
- 每次调用返回`2`、`3`或`4`的概率应该是相等的。

**1.3 提示**:
- 数组`nums`中的所有元素都在`-2^31`至`2^31 - 1`之间。
- 给定的数字`target`保证在数组`nums`中存在。
- 最多会调用`104`次`pick`方法。

## 2. 边界情况和约束
**边界情况和约束**：

1. 数组`nums`可以非常大，需要注意空间复杂度。
2. `target`在`nums`中出现的次数可以是任意的，可能是`1`次，也可能是多次。
3. 要求每次返回的索引概率相等，即要实现均匀随机抽样。

## 3. 算法和策略
**算法和策略**：

1. **初始化**：
   - 将给定的`nums`数组保存在类的属性中以供后续使用。
   - 不预处理`nums`中每个元素的索引，以优化空间复杂度。

2. **随机抽取索引**：
   - 使用水塘抽样算法（Reservoir Sampling）进行索引的随机选择。
   - 遍历数组，每次遇到目标值`target`时，以`1/n`的概率保留这个索引，其中`n`是到目前为止遇到`target`的次数。

3. **水塘抽样算法详解**：
   - 维护一个计数器，记录目标值`target`出现的次数。
   - 对于每个`target`的出现，生成一个`[0, n-1]`范围内的随机数，如果这个随机数等于`0`（或任意固定值），则选择当前的索引作为结果。这样可以确保每个索引被选中的概率都是`1/n`。

---